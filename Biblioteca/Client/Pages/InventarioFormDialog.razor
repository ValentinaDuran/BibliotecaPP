@using Biblioteca.BD.Data.Entidades
@using Biblioteca.Client.Services
@inject IHttpService http
@inject NavigationManager NavManager
@using MudBlazor
<MudDialog iOpen="isOpen">
    <DialogContent>
        <MudForm>
            <MudGrid>
                    <MudItem xs="6">
                        <MudTextField @bind-Value="newInventario.TituloNombre" Label="Título/Nombre" />
                    </MudItem>
                    <MudItem xs="6">
                        <MudTextField @bind-Value="newInventario.AutorMarca" Label="Autor/marca" />
                    </MudItem>
                    <MudItem xs="6">
                        <MudTextField @bind-Value="newInventario.Observacion" Label="Observación" />
                    </MudItem>
                    <MudItem xs="6">
                        <MudSelect T="int" @bind-Value="newInventario.TipoId" Label="Tipo">
                            @foreach (var tipo in tipos)
                            {
                                <MudSelectItem Value="@tipo.TipoId">@tipo.TipoMat</MudSelectItem>
                            }
                        </MudSelect>
                    </MudItem>
                     <MudItem xs="6">
                        <MudTextField @bind-Value="newInventario.Codigo" Label="Codigo" />
                    </MudItem>
            </MudGrid>
        </MudForm>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">Cancelar</MudButton>
        <MudButton Color="Color.Primary" OnClick="Submit">Agregar</MudButton>
    </DialogActions>
</MudDialog>
@code {
      private bool isOpen = false;


      private Inventario editedInventario = new Inventario(); // Datos del inventario a editar
  

    // Evento personalizado del componente de la tabla
    [Parameter] public Action<Inventario> OnEditarInventario { get; set; }

    protected override void OnInitialized()
    {
        // Suscribirse al evento personalizado del componente de la tabla
        OnEditarInventario += EditarInventario;
    }

    // Método para recibir la notificación del evento y abrir el diálogo
    private void EditarInventario(Inventario inventario)
    {
        // Abrir el diálogo y llenar los campos con los datos de la fila seleccionada
        editedInventario = inventario;
        isOpen = true;
    }

   

    [CascadingParameter] MudDialogInstance MudDialog { get; set; }
    private Inventario newInventario = new Inventario();
     static List<Tipo> tipos = new List<Tipo>
    {
        new Tipo{ TipoId= 1,TipoMat= "Libro"},
        new Tipo{ TipoId= 2,TipoMat= "Mapa"},
        new Tipo{ TipoId= 3,TipoMat= "ÚtilGeometria"},
        new Tipo{ TipoId= 4,TipoMat= "Computadora"},
        new Tipo{ TipoId= 5,TipoMat= "Proyector"},
        new Tipo{ TipoId= 6,TipoMat= "Revista"},
        new Tipo{ TipoId= 7,TipoMat= "Ludoteca"},
        new Tipo{ TipoId= 8,TipoMat= "InstrumentoMusical"},
   
    };



    private async void Submit(){

         var httpRespuesta = await http.Post<Inventario>("api/InventarioController", newInventario);
    if (!httpRespuesta.Error)
    {
   
        MudDialog.Close();
        NavManager.NavigateTo("/inventario-list", forceLoad: true);
    }
    else
    {
     
        var body = httpRespuesta.HttpResponseMessage;
    }
    }


    void Cancel() => MudDialog.Cancel();

      void OpenDialog()
    {
        isOpen = true;
    }
}
